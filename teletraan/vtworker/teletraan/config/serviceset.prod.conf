version: 1
vtworker:
    docker:
        image: vitess
        user: prod
        volumes:
            - /mnt/vtdataroot:/vt/vtdataroot
        environment:
            - HEAP_SIZE=8G
            - NEW_SIZE=4G
        command: bash -c "/vt/scripts/vtworker_startup.sh -d 2>&1 > /vt/vtdataroot/vtworker.out"
    sidecars:
        zum:
        knox:
zk-register-service-vtworker:
    docker:
        image: zk-register-service
        version: latest
        volumes:
            - /etc/cellaware_zk_paths.conf:/etc/cellaware_zk_paths.conf
        tmpfs:
            - /tmp
        command: --environment {{STAGE_NAME}} --service {{ENV_NAME}} --port 15033
        healthcheck:
            test: ["CMD", "curl", "-f", "http://localhost:15032/debug/health"]
            interval: 10
            timeout: 1
            start_period: 5
            retries: 3
    sidecars:
        zum: